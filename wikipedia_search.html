<!-- BEGIN WIKIPEDIA SEARCH MODULE -->
<div id="wikiSearchModule">
  <h2>Wikipedia Search</h2>
  <input
    type="text"
    id="wikiSearchInput"
    placeholder="Enter a search term..."
    style="width: 250px;"
  />
  <button id="wikiSearchBtn">Search</button>
  
  <div id="wikiResults" style="margin-top: 1em;"></div>
</div>

<script>
  // When the user clicks the Search button:
  document.getElementById('wikiSearchBtn').addEventListener('click', function() {
    const searchTerm = document.getElementById('wikiSearchInput').value.trim();
    if (searchTerm) {
      searchWikipedia(searchTerm);
    }
  });
  
  // You can also allow pressing Enter in the input box:
  document.getElementById('wikiSearchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      document.getElementById('wikiSearchBtn').click();
    }
  });

  // Fetch a list of search results from the Wikipedia API
  function searchWikipedia(searchTerm) {
    const endpoint =
      'https://en.wikipedia.org/w/api.php' +
      '?action=query' +
      '&list=search' +
      '&format=json' +
      '&origin=*' +
      '&srsearch=' + encodeURIComponent(searchTerm);

    fetch(endpoint)
      .then(response => response.json())
      .then(data => {
        if (data.query && data.query.search) {
          displaySearchResults(data.query.search);
        } else {
          document.getElementById('wikiResults').innerHTML = '<p>No results found.</p>';
        }
      })
      .catch(err => {
        console.error('Error fetching search results:', err);
        document.getElementById('wikiResults').innerHTML = '<p>Error fetching results.</p>';
      });
  }

  // Show the list of search results
  function displaySearchResults(results) {
    const resultsContainer = document.getElementById('wikiResults');
    resultsContainer.innerHTML = ''; // Clear previous content

    if (results.length === 0) {
      resultsContainer.innerHTML = '<p>No results found.</p>';
      return;
    }

    const list = document.createElement('ul');
    list.style.listStyleType = 'none'; // Remove bullet points
    results.forEach(item => {
      const listItem = document.createElement('li');
      const link = document.createElement('a');
      link.href = 'javascript:void(0)';
      link.textContent = item.title;
      
      // When clicked, fetch and display the entire article with image and infobox
      link.addEventListener('click', () => {
        getFullArticleWithImageAndInfobox(item.title);
      });
      listItem.appendChild(link);
      list.appendChild(listItem);
    });
    resultsContainer.appendChild(list);
  }

  // Fetch the full content of the selected article with an image and infobox
  function getFullArticleWithImageAndInfobox(title) {
    const endpoint =
      'https://en.wikipedia.org/w/api.php' +
      '?action=parse' +
      '&format=json' +
      '&origin=*' +
      '&page=' + encodeURIComponent(title) +
      '&prop=text|images';

    fetch(endpoint)
      .then(response => response.json())
      .then(data => {
        if (data.parse) {
          const pageTitle = data.parse.title;
          const pageHtml = data.parse.text['*'];
          
          // Extract infobox and main content from the HTML
          const parser = new DOMParser();
          const doc = parser.parseFromString(pageHtml, 'text/html');
          
          const infobox = doc.querySelector('.infobox');
          const content = doc.querySelector('.mw-parser-output');

          const imageUrl = data.parse.images[0] ? `https://en.wikipedia.org/wiki/Special:FilePath/${data.parse.images[0]}` : '';

          // Replace the search results with the article content, infobox, and image
          document.getElementById('wikiResults').innerHTML = `
            <h3>${pageTitle}</h3>
            ${imageUrl ? `<img src="${imageUrl}" alt="${pageTitle}" style="max-width: 100%; height: auto;">` : ''}
            ${infobox ? infobox.outerHTML : ''}
            <div>${content ? content.innerHTML : ''}</div>
            <p><a href="https://en.wikipedia.org/wiki/${encodeURIComponent(pageTitle)}" target="_blank">Read more on Wikipedia</a></p>
          `;
        } else {
          document.getElementById('wikiResults').innerHTML = '<p>Could not load article content.</p>';
        }
      })
      .catch(err => {
        console.error('Error fetching article content:', err);
        document.getElementById('wikiResults').innerHTML = '<p>Error fetching article content.</p>';
      });
  }
</script>
<!-- END WIKIPEDIA SEARCH MODULE -->